/* ========================================================================
   Copyright (c) 1990,1995   Synergistic Software
   All Rights Reserved.
   =======================================================================
   Filename: SCAN.C      -???
   Author: Chris Phillips
   ========================================================================
   Contains the following internal functions:

   Contains the following general functions:
   scan_line             -???

   ======================================================================== */
/* ------------------------------------------------------------------------
   Includes
   ------------------------------------------------------------------------ */
#include <stdio.h>
#include "system.h"
#include "engine.h"

/* ------------------------------------------------------------------------
   Notes
   ------------------------------------------------------------------------ */
	//REVISIT:Should be able to speed this up BIG TIME (tm)!!!!

/* ------------------------------------------------------------------------
   Defines and Compile Flags
   ------------------------------------------------------------------------ */
/* ------------------------------------------------------------------------
   Macros
   ------------------------------------------------------------------------ */
/* ------------------------------------------------------------------------
   Prototypes
   ------------------------------------------------------------------------ */
/* ------------------------------------------------------------------------
   Global Variables
   ------------------------------------------------------------------------ */

/* ========================================================================
   Function    - scan_line
   Description - ???
   Returns     - void
   ======================================================================== */
void scan_line (POINT *a, POINT *b, LONG * array)
{
	LONG d,x,y,ax,ay,sx,sy,dx,dy;
	LONG x0,y0,x1,y1;

	x0 = a->x;
	y0 = a->y;
	x1 = b->x;
	y1 = b->y;

	dx = x1 - x0;
	dy = y1 - y0;

	ax = ABS (dx) << 1;
	ay = ABS (dy) << 1;

	sx = SGN (dx);
	sy = SGN (dy);

	x = x0;
	y = y0;

	if (ax>ay)
	{
		/* X dominant */

		d = ay - (ax >> 1);
		while (TRUE)
		{
			if (x == x1)
				break;
			if (d>=0)
			{
				y += sy;
				d -= ax;
			}

			if (x>=0 && x<MAX_VIEW_WIDTH)
				array[x]=y;

			x += sx;
			d += ay;
		}
	}
	else
	{
		/* Y dominant */

		d = ax - (ay >> 1);
		while (TRUE)
		{
			if (y == y1)
				break;
			if (d>=0)
			{
				if (x>=0 && x<MAX_VIEW_WIDTH)
					array[x]=y;
				x += sx;
				d -= ay;
			}
			y += sy;
			d += ax;
		}
	}

	if (x>=0 && x<MAX_VIEW_WIDTH)
		array[x]=y;
}
